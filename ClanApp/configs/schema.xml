<?xml version="1.0" encoding="UTF-8"?>
<database name="FusionCore" namespace="ClanApp\entities" defaultIdMethod="native" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../../developer/database.xsd">

    <!--
        These records will only be created for players who wish to register with the system for extra
        functionality and control. Regular players don't need to register as methods will be available
        for them to interact without accounts.
    -->
    <table name="users" phpName="User">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="email" type="VARCHAR" required="false"/>
        <column name="password" type="VARCHAR" size="60" required="true"/>
        <column name="remember_token" type="VARCHAR" size="60" required="false"/>
        <column name="member_id" type="INTEGER" required="true"/>
        <foreign-key foreignTable="members">
            <reference local="member_id" foreign="id"/>
        </foreign-key>
    </table>

    <!--
        We split the member records (those that represent game characters) from the user records (which represent
        the humans interacting with the site) because not everyone that uses the site will interact in a way that
        requires a user account. User accounts will almost exclusively be used for administering the site. The
        only other use will be for editing (a subset of) details about the player's own member account.
    -->
    <table name="members" phpName="Member">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="name" type="VARCHAR" size="20" required="true"/>
        <column name="joined_on" type="DATE"/>
        <column name="left_on" type="DATE"/>
        <column name="rank" type="VARCHAR" size="30" required="true"/>
    </table>

    <!-- PERMISSIONS SYSTEM TABLES START -->

    <table name="permissions" phpName="Permission">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="tag" type="VARCHAR" size="30" required="true"/>
        <column name="name" type="VARCHAR" size="30" required="true"/>
    </table>

    <table name="roles" phpName="Role">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="name" type="VARCHAR" size="50" required="true"/>
    </table>

    <table name="user_roles" phpName="UserRole">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="user_id" type="INTEGER" required="true"/>
        <column name="role_id" type="INTEGER" required="true"/>
        <foreign-key foreignTable="users">
            <reference local="user_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="roles">
            <reference local="role_id" foreign="id"/>
        </foreign-key>
    </table>

    <table name="role_permissions" phpName="RolePermission">
        <column name="id" type="INTEGER" required="true" primaryKey="true" autoIncrement="true"/>
        <column name="permission_id" type="INTEGER" required="true"/>
        <column name="role_id" type="INTEGER" required="true"/>
        <foreign-key foreignTable="permissions">
            <reference local="permission_id" foreign="id"/>
        </foreign-key>
        <foreign-key foreignTable="roles">
            <reference local="role_id" foreign="id"/>
        </foreign-key>
    </table>

    <!-- PERMISSIONS SYSTEM TABLES END -->

</database>
